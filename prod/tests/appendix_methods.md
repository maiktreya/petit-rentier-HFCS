📊 Reader’s Map of the Pipeline

Textual Flow (for the appendix)

HFCS dataset (multiply imputed, household × wave × country)
          │
          ▼
 DV construction (Capital income share > threshold)
   ├── Baseline (excl. K-gains, no hasKgains regressor)
   ├── K-inclusive (incl. K-gains, add hasKgains regressor)
   └── Trimmed (K-gains winsorized at P99)

          │
          ▼
 Crossed-effects logistic regression (country + country×wave RE)
          │
          ▼
       Diagnostics
   ├── AMEs + Δ-AME (substantive effects)
   ├── Random effects / ICC + rank correlation
   ├── Mundlak decomposition (within vs contextual)
   ├── Threshold sweep (5–40%)
   ├── Tail sensitivity (trimmed K-gains)
   └── Leave-one-out influence (country & wave)

          │
          ▼
        Outputs (CSV)
   ├── Coefficients: coef_baseline.csv, coef_k_inclusive.csv, coef_k_trim99.csv
   ├── AMEs: ame_baseline.csv, ame_k_inclusive.csv, ame_k_trim99.csv
   ├── Δ-AME: ame_delta_pct.csv
   ├── RE variances/ICC: re_icc_compare.csv
   ├── RE rank correlation: re_rho.txt
   ├── Mundlak effects: coef_mundlak_hasKgains.csv
   ├── Threshold sweep: threshold_sweep_AME.csv
   ├── LOO influence: loo_*csv + delta_loo_*csv
   └── Dashboard bundle: dashboard_bundle.rds


---

R Code to Produce the Flowchart

# install.packages("DiagrammeR")
library(DiagrammeR)

grViz("
digraph pipeline {
  graph [rankdir = TB, fontsize=10, labelloc='t']
  node [shape=box, style=filled, color=gray90, fontname=Helvetica]

  A [label='HFCS dataset (multiply imputed)']
  B [label='DV construction\n(Capital income share > threshold)']
  C1 [label='Baseline\n(excl. K-gains)']
  C2 [label='K-inclusive\n(+ K-gains, + hasKgains)']
  C3 [label='Trimmed\n(K-gains winsorized)']
  D [label='Crossed-effects logit\n(country + country×wave RE)']
  E [label='Diagnostics:\n- AMEs + Δ-AME\n- RE/ICC + rank corr\n- Mundlak\n- Threshold sweep\n- Tail sensitivity\n- LOO influence']
  F [label='Outputs (CSV files)\ncoef_*, ame_*, re_*, loo_*, dashboard.rds']

  A -> B
  B -> {C1 C2 C3}
  {C1 C2 C3} -> D
  D -> E
  E -> F
}
")

This produces a clean top-to-bottom schematic with boxes: dataset → DV creation → model variants → estimation → diagnostics → outputs.


---

Caption suggestion for your appendix

> Figure A0. Reader’s Map of the Robustness Pipeline.
The pipeline begins with the multiply imputed HFCS dataset, constructs the petit-rentier dependent variable under three specifications (baseline, K-inclusive, trimmed), estimates crossed-effects logit models, and subjects them to six diagnostic tests. All outputs are written to CSVs in output/MODELS/MICRO/Kgains_pipeline/.




---



Appendix A. Sensitivity Analysis of Capital Gains Inclusion

This appendix documents the robustness checks conducted to assess whether the inclusion of realized capital gains in our definition of capital income biases estimates of petit-rentier prevalence and determinants in the HFCS multilevel models. All outputs are generated by the pipeline and written to:

output/MODELS/MICRO/Kgains_pipeline/


---

A.1 Baseline and Alternative Model Specifications

Baseline model: CI excludes K-gains; no hasKgains regressor.

K-inclusive model: CI includes K-gains; hasKgains added to covariates.

Trimmed model: Same as K-inclusive but K-gains winsorized at the 99th percentile (country×wave).


All models are crossed-effects logits with random intercepts at country and country×wave, pooled across imputations with Rubin’s rules.


---

A.2 Average Marginal Effects (AMEs) and Δ-AME

AMEs: ame_baseline.csv, ame_k_inclusive.csv, ame_k_trim99.csv

Δ-AMEs: ame_delta_pct.csv


Table A1. AMEs (baseline vs K-inclusive vs trimmed)

> Source: CSV files listed above.



Table A2. Δ-AMEs (% change vs baseline)

> Source: ame_delta_pct.csv.




---

A.3 Random Effects and ICC

Variance components + ICC: re_icc_compare.csv

Country RE rank correlation: re_rho.txt


Table A3. Random effects variances and ICCs

> Source: re_icc_compare.csv.



Figure A1. Country random effects baseline vs K-inclusive

> Construct from RE estimates in re_icc_compare.csv.
Caption: Scatter of country REs; Spearman ρ from re_rho.txt.




---

A.4 Mundlak Decomposition

Coefficients (within vs between): coef_mundlak_hasKgains.csv


Table A4. Mundlak decomposition for hasKgains

> Source: coef_mundlak_hasKgains.csv.




---

A.5 Threshold Sweep

Sweep AMEs across thresholds: threshold_sweep_AME.csv


Figure A2. AME of other-property across thresholds (5–40%)

> Source: threshold_sweep_AME.csv.




---

A.6 Outlier Sensitivity

Trimmed model AMEs: ame_k_trim99.csv


Interpretation: Compare with untrimmed (ame_k_inclusive.csv) to check tail sensitivity.


---

A.7 Leave-One-Out (LOO) Diagnostics

LOO AMEs (country): loo_country_baseline.csv, loo_country_k_inclusive.csv

LOO AMEs (wave): loo_wave_baseline.csv, loo_wave_k_inclusive.csv

Max Δ-AME summaries:

delta_loo_country_baseline_delta.csv

delta_loo_country_k_inclusive_delta.csv

delta_loo_wave_baseline_delta.csv

delta_loo_wave_k_inclusive_delta.csv



Table A5. Maximum LOO influence on AMEs

> Source: delta_loo*.csv files.



Figure A3. Distribution of LOO Δ-AMEs (country & wave)

> Source: loo*.csv files.




---

A.8 Decision Rules

We declare robustness if:

|Δ-AME| ≤ 15% for key covariates.

ICC shift ≤ 0.03 and RE ρ ≥ 0.85.

Mundlak does not show dominance of contextual effect.

Threshold sweep stable.

Trimmed vs untrimmed consistent.

No LOO exclusion changes AME > 25% or flips sign.



---

A.9 Deliverables

Tables A1–A5 generated from CSVs.

Figures A1–A3 constructed from CSVs.

Dashboard bundle: dashboard_bundle.rds (compact object for plotting).



---

Summary

This pipeline separates benign rescaling from pervasive bias when including capital gains. All intermediate results are automatically exported as CSVs, ensuring reproducibility and allowing direct linking from manuscript tables/figures.


---

👉 With this setup, you can keep your manuscript lightweight (“see Appendix A, Table A1 from ame_baseline.csv”), while your repo/supplementary package delivers the full detail.

Would you like me to also prepare a one-page “reader’s map” figure (a schematic flowchart of the pipeline steps → outputs) that you can drop at the start of the appendix?

